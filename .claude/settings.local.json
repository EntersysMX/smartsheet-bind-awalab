{
  "permissions": {
    "allow": [
      "Bash(python -c \"\nimport smartsheet\nfrom smartsheet.models import Column\n\nACCESS_TOKEN = ''rVcpRyiLctXXwjnmh09dEpPiZfzrodlTUdBWd''\nSHEET_ID = 4956740131966852\n\nclient = smartsheet.Smartsheet\\(ACCESS_TOKEN\\)\nclient.errors_as_exceptions\\(True\\)\n\n# Columnas a agregar \\(las que faltan\\)\nNEW_COLUMNS = [\n    {''title'': ''Cantidad'', ''type'': ''TEXT_NUMBER''},\n    {''title'': ''Precio Unitario'', ''type'': ''TEXT_NUMBER''},\n    {''title'': ''Clave SAT Producto'', ''type'': ''TEXT_NUMBER''},\n    {''title'': ''Clave SAT Unidad'', ''type'': ''TEXT_NUMBER''},\n    {''title'': ''Metodo Pago'', ''type'': ''PICKLIST'', ''options'': [''PUE'', ''PPD'']},\n    {''title'': ''Forma Pago'', ''type'': ''TEXT_NUMBER''},\n    {''title'': ''Uso CFDI'', ''type'': ''TEXT_NUMBER''},\n    {''title'': ''Regimen Fiscal'', ''type'': ''TEXT_NUMBER''},\n    {''title'': ''Codigo Postal'', ''type'': ''TEXT_NUMBER''},\n    {''title'': ''Estado'', ''type'': ''PICKLIST'', ''options'': [''Pendiente'', ''Facturar'', ''Facturado'', ''Error'']},\n    {''title'': ''UUID'', ''type'': ''TEXT_NUMBER''},\n    {''title'': ''Folio Fiscal'', ''type'': ''TEXT_NUMBER''},\n    {''title'': ''Fecha Facturacion'', ''type'': ''TEXT_NUMBER''},\n    {''title'': ''Resultado'', ''type'': ''TEXT_NUMBER''},\n]\n\n# Obtener hoja actual\nsheet = client.Sheets.get_sheet\\(SHEET_ID\\)\ncurrent_cols = len\\(sheet.columns\\)\nprint\\(f''Columnas actuales: {current_cols}''\\)\n\n# Agregar columnas con indice\nfor i, col_def in enumerate\\(NEW_COLUMNS\\):\n    col = Column\\(\\)\n    col.title = col_def[''title'']\n    col.type = col_def[''type'']\n    col.index = current_cols + i  # Indice al final\n    if ''options'' in col_def:\n        col.options = col_def[''options'']\n    \n    try:\n        result = client.Sheets.add_columns\\(SHEET_ID, [col]\\)\n        print\\(f''  Agregada: {col_def[\"\"title\"\"]}''\\)\n    except Exception as e:\n        print\\(f''  Error: {col_def[\"\"title\"\"]} - {e}''\\)\n\nprint\\(''\\\\nColumnas agregadas!''\\)\n\")",
      "Bash(curl:*)",
      "Bash(jq:*)",
      "Bash(python:*)",
      "Bash(gcloud compute ssh prod-server --zone=us-central1-c --command=\"cd /srv/apps_entersys/smartsheet_bind_awalab && docker compose logs --tail=100 2>&1 | grep -E ''Running job|Ejecutando|completada|Sincronización|added|skipped|Error''\")",
      "Bash(gcloud compute ssh prod-server --zone=us-central1-c --command=\"cd /srv/apps_entersys/smartsheet_bind_awalab && docker compose exec middleware python -c \"\"\nfrom sync_bind_catalogs import sync_all_bind_catalogs\nimport json\n\nprint\\(''Ejecutando sincronización inicial de todos los catálogos...''\\)\nprint\\(''Esto puede tomar varios minutos...''\\)\nprint\\(\\)\n\nresults = sync_all_bind_catalogs\\(\\)\n\nprint\\(\\)\nprint\\(''=== RESULTADOS ===''\\)\nfor name, result in results.items\\(\\):\n    if result.get\\(''success''\\):\n        print\\(f''{name}: OK - {result.get\\(\"\"total_records\"\", 0\\)} registros \\({result.get\\(\"\"inserted\"\", 0\\)} nuevos, {result.get\\(\"\"updated\"\", 0\\)} actualizados\\)''\\)\n    else:\n        print\\(f''{name}: ERROR - {result.get\\(\"\"error\"\", \"\"Unknown error\"\"\\)}''\\)\n\"\"\")"
    ]
  }
}
